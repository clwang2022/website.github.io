pch=18, psize=psize, xlab= "", cex=1.05, digits=2, refline = NA, efac = 2, col=colp, border=colp,
#slab = paste(dat.ref$author, dat.ref$year),
slab = slab.ref,
#ilab = cbind(dat.ref$age, paste(dat.ref$incidents, "/", dat.ref$population), weights),
ilab = cbind(paste(dat.ref$`incidence(n/N)`), weights),
#ilab.xpos = cbind(-3.7, -2.5, 1.4),
ilab.xpos = cbind(-2.5, 1.4),
mlab="", rowadj = -0.07)
### add vertical reference line at 1
segments(0, -2, 0, k+1, col=coll, lwd = 0.8)
### add vertical reference line at the pooled estimate
segments(coef(res), -1, coef(res), k, col=colp, lty="33", lwd=1.5)
### redraw the CI lines and points in the chosen color
#points(res$yi, k:1, pch=16, cex=psize*1.15, col="white")
points(res$yi, k:1, pch=18, cex=psize, col="black")
### now we add a bunch of text; since some of the text falls outside of the
### plot region, we set xpd=NA so nothing gets clipped
par(xpd=NA)
### use a non-bold font for the rest of the text
par(cex=sav$cex, font=1)
text(c(-5.4, 1.4), -0.95, c("Total", "100.0"))
### add 'Favours caffeine'/'Favours decaf' text below the x-axis
#install.packages('shape')
#library(shape)
#Arrows(0.2,-3.4, 1.2,-3.4, arr.type="triangle", lwd = 1)
#Arrows(-0.1,-3.4, -1.1,-3.4, arr.type="triangle", lwd = 1)
Arrows(0.2,-3.4, 1.2,-3.4, arr.adj = 0.5, arr.type="triangle", lwd = 1)
Arrows(-0.1,-3.4, -1.1,-3.4, arr.adj = 0.5, arr.type="triangle", lwd = 1)
text(c(-1.5, 1.4), -4, c("Favours rhinitis prevention","Favours rhinitis risk" ), pos=c(3,3), offset=-0.3)
### adjust cex as used in the forest plot and use a bold font
par(cex=sav$cex, font=2)
### add headings
#text(c(-3.7, -2.5, 1.4, 3), k+2.5, c("Age", paste("Incidents(n/N)"), "Weight", "Odds ratio"))
#text(c(-3.7, -2.5, 1.4, 3), k+1.5, c("(years)", "population",  "(%)", "(95% CI)"))
text(c(-2.5, 1.4, 3), k+2.5, c(paste("Incidence"), "Weight", "Odds ratio"))
text(c(-2.5, 1.4, 3), k+1.5, c("%(n/N)",  "(%)", "(95% CI)"))
### add text with Q-value, dfs, p-value, and I^2 statistic
text(-5.7, -1.8, pos = 4, "Random-effect model")
text(-5.7, -2.8, pos = 4, bquote(paste("Heterogeneity: ", I^2, "=", .(formatC(res$I2, digits = 0, format = "f")),
"%; p=", .(formatC(res$QEp, digits = 4, format = "f")))))
####3. funnel plot####
### carry out trim-and-fill analysis
taf <- trimfill(res)
funnel(taf, back = "white", atransf = exp, xlab = "Odds Ratio")
### add 'Favours caffeine'/'Favours decaf' text below the x-axis
#install.packages('shape')
#library(shape)
#Arrows(0.2,-3.4, 1.2,-3.4, arr.type="triangle", lwd = 1)
#Arrows(-0.1,-3.4, -1.1,-3.4, arr.type="triangle", lwd = 1)
Arrows(0.2,-3.4, 1.2,-3.4, arr.adj = 0.3, arr.type="triangle", lwd = 1)
### add 'Favours caffeine'/'Favours decaf' text below the x-axis
#install.packages('shape')
#library(shape)
#Arrows(0.2,-3.4, 1.2,-3.4, arr.type="triangle", lwd = 1)
#Arrows(-0.1,-3.4, -1.1,-3.4, arr.type="triangle", lwd = 1)
Arrows(0.2,-3.4, 1.2,-3.4, arr.adj = 0.3, arr.type="triangle", lwd = 1)
Arrows(-0.1,-3.4, -1.1,-3.4, arr.adj = 0.3, arr.type="triangle", lwd = 1)
## read in data
#install.packages("openxlsx")
library(openxlsx)
pacman::p_load(ggplot2, openxlsx, shape)
## 1. main model
library(metafor)
dat.ref <- read.xlsx(xlsxFile = 'C:/Users/wclzsdkjdx/Desktop/UOTP1 Greenness and rhinitis/data/Studies included in meta-analysis.xlsx', sheet = 1)
## claculate log(OR)
yi<-log(dat.ref$adj_r)
## calculate standardized deviation
er<-(log(dat.ref$adj_r)-log(dat.ref$adj_low))/1.96
vi<-er*er
### create study labels
dat.ref$slab <- with(dat.ref, paste(dat.ref$author, dat.ref$year, sep=", "))
### combine study labels with trial numbers in superscripts
dat.ref$slab.ref <- mapply(function(x,y) as.expression(bquote(.(x)^.(y))), dat.ref$slab, dat.ref$trial)
# meta-analysis, random-effects model
res<-rma(yi,vi, data = dat.ref, method="REML")
res
predict(res,transf = exp, digits = 3)
regtest(res, model = "lm")
### colors to be used in the plot
colp <- "#6b58a6"
coll <- "#a7a9ac"
### total number of studies
k <- nrow(dat.ref)
### generate point sizes
psize <- weights(res)
psize <- 1 + (psize - min(psize)) / (max(psize) - min(psize))
### get the weights and format them as will be used in the forest plot
weights <- formatC(weights(res), format="f", digits=1)
### forest plot with extra annotations
sav <- forest(res,  atransf=exp, at=log(c(0.4,1,1.6)), xlim = c(-5.8, 3.6), ylim = c(-0.95, k+3),
pch=18, psize=psize, xlab= "", cex=1.05, digits=2, refline = NA, efac = 2, col=colp, border=colp,
#slab = paste(dat.ref$author, dat.ref$year),
slab = slab.ref,
#ilab = cbind(dat.ref$age, paste(dat.ref$incidents, "/", dat.ref$population), weights),
ilab = cbind(paste(dat.ref$`incidence(n/N)`), weights),
#ilab.xpos = cbind(-3.7, -2.5, 1.4),
ilab.xpos = cbind(-2.5, 1.4),
mlab="", rowadj = -0.07)
### add vertical reference line at 1
segments(0, -2, 0, k+1, col=coll, lwd = 0.8)
### add vertical reference line at the pooled estimate
segments(coef(res), -1, coef(res), k, col=colp, lty="33", lwd=1.5)
### redraw the CI lines and points in the chosen color
#points(res$yi, k:1, pch=16, cex=psize*1.15, col="white")
points(res$yi, k:1, pch=18, cex=psize, col="black")
### now we add a bunch of text; since some of the text falls outside of the
### plot region, we set xpd=NA so nothing gets clipped
par(xpd=NA)
### use a non-bold font for the rest of the text
par(cex=sav$cex, font=1)
text(c(-5.4, 1.4), -0.95, c("Total", "100.0"))
### add 'Favours caffeine'/'Favours decaf' text below the x-axis
#install.packages('shape')
#library(shape)
#Arrows(0.2,-3.4, 1.2,-3.4, arr.type="triangle", lwd = 1)
#Arrows(-0.1,-3.4, -1.1,-3.4, arr.type="triangle", lwd = 1)
Arrows(0.2,-3.4, 1.2,-3.4, arr.adj = 0.3, arr.type="triangle", lwd = 1)
Arrows(-0.1,-3.4, -1.1,-3.4, arr.adj = 0.3, arr.type="triangle", lwd = 1)
text(c(-1.5, 1.4), -4, c("Favours rhinitis prevention","Favours rhinitis risk" ), pos=c(3,3), offset=-0.3)
### adjust cex as used in the forest plot and use a bold font
par(cex=sav$cex, font=2)
### add headings
#text(c(-3.7, -2.5, 1.4, 3), k+2.5, c("Age", paste("Incidents(n/N)"), "Weight", "Odds ratio"))
#text(c(-3.7, -2.5, 1.4, 3), k+1.5, c("(years)", "population",  "(%)", "(95% CI)"))
text(c(-2.5, 1.4, 3), k+2.5, c(paste("Incidence"), "Weight", "Odds ratio"))
text(c(-2.5, 1.4, 3), k+1.5, c("%(n/N)",  "(%)", "(95% CI)"))
### add text with Q-value, dfs, p-value, and I^2 statistic
text(-5.7, -1.8, pos = 4, "Random-effect model")
text(-5.7, -2.8, pos = 4, bquote(paste("Heterogeneity: ", I^2, "=", .(formatC(res$I2, digits = 0, format = "f")),
"%; p=", .(formatC(res$QEp, digits = 4, format = "f")))))
### add 'Favours caffeine'/'Favours decaf' text below the x-axis
#install.packages('shape')
#library(shape)
#Arrows(0.2,-3.4, 1.2,-3.4, arr.type="triangle", lwd = 1)
#Arrows(-0.1,-3.4, -1.1,-3.4, arr.type="triangle", lwd = 1)
Arrows(0.2,-3.4, 1.2,-3.4, arr.adj = 0.5, arr.type="triangle", lwd = 0.8)
## read in data
#install.packages("openxlsx")
library(openxlsx)
pacman::p_load(ggplot2, openxlsx, shape)
## 1. main model
library(metafor)
dat.ref <- read.xlsx(xlsxFile = 'C:/Users/wclzsdkjdx/Desktop/UOTP1 Greenness and rhinitis/data/Studies included in meta-analysis.xlsx', sheet = 1)
## claculate log(OR)
yi<-log(dat.ref$adj_r)
## calculate standardized deviation
er<-(log(dat.ref$adj_r)-log(dat.ref$adj_low))/1.96
vi<-er*er
### create study labels
dat.ref$slab <- with(dat.ref, paste(dat.ref$author, dat.ref$year, sep=", "))
### combine study labels with trial numbers in superscripts
dat.ref$slab.ref <- mapply(function(x,y) as.expression(bquote(.(x)^.(y))), dat.ref$slab, dat.ref$trial)
# meta-analysis, random-effects model
res<-rma(yi,vi, data = dat.ref, method="REML")
res
predict(res,transf = exp, digits = 3)
regtest(res, model = "lm")
### colors to be used in the plot
colp <- "#6b58a6"
coll <- "#a7a9ac"
### total number of studies
k <- nrow(dat.ref)
### generate point sizes
psize <- weights(res)
psize <- 1 + (psize - min(psize)) / (max(psize) - min(psize))
### get the weights and format them as will be used in the forest plot
weights <- formatC(weights(res), format="f", digits=1)
### forest plot with extra annotations
sav <- forest(res,  atransf=exp, at=log(c(0.4,1,1.6)), xlim = c(-5.8, 3.6), ylim = c(-0.95, k+3),
pch=18, psize=psize, xlab= "", cex=1.05, digits=2, refline = NA, efac = 2, col=colp, border=colp,
#slab = paste(dat.ref$author, dat.ref$year),
slab = slab.ref,
#ilab = cbind(dat.ref$age, paste(dat.ref$incidents, "/", dat.ref$population), weights),
ilab = cbind(paste(dat.ref$`incidence(n/N)`), weights),
#ilab.xpos = cbind(-3.7, -2.5, 1.4),
ilab.xpos = cbind(-2.5, 1.4),
mlab="", rowadj = -0.07)
### add vertical reference line at 1
segments(0, -2, 0, k+1, col=coll, lwd = 0.8)
### add vertical reference line at the pooled estimate
segments(coef(res), -1, coef(res), k, col=colp, lty="33", lwd=1.5)
### redraw the CI lines and points in the chosen color
#points(res$yi, k:1, pch=16, cex=psize*1.15, col="white")
points(res$yi, k:1, pch=18, cex=psize, col="black")
### now we add a bunch of text; since some of the text falls outside of the
### plot region, we set xpd=NA so nothing gets clipped
par(xpd=NA)
### use a non-bold font for the rest of the text
par(cex=sav$cex, font=1)
text(c(-5.4, 1.4), -0.95, c("Total", "100.0"))
### add 'Favours caffeine'/'Favours decaf' text below the x-axis
#install.packages('shape')
#library(shape)
#Arrows(0.2,-3.4, 1.2,-3.4, arr.type="triangle", lwd = 1)
#Arrows(-0.1,-3.4, -1.1,-3.4, arr.type="triangle", lwd = 1)
Arrows(0.2,-3.4, 1.2,-3.4, arr.adj = 0.5, arr.type="triangle", lwd = 1)
Arrows(-0.1,-3.4, -1.1,-3.4, arr.adj = 0.5, arr.type="triangle", lwd = 1)
text(c(-1.5, 1.4), -4, c("Favours rhinitis prevention","Favours rhinitis risk" ), pos=c(3,3), offset=-0.3)
### adjust cex as used in the forest plot and use a bold font
par(cex=sav$cex, font=2)
### add headings
#text(c(-3.7, -2.5, 1.4, 3), k+2.5, c("Age", paste("Incidents(n/N)"), "Weight", "Odds ratio"))
#text(c(-3.7, -2.5, 1.4, 3), k+1.5, c("(years)", "population",  "(%)", "(95% CI)"))
text(c(-2.5, 1.4, 3), k+2.5, c(paste("Incidence"), "Weight", "Odds ratio"))
text(c(-2.5, 1.4, 3), k+1.5, c("%(n/N)",  "(%)", "(95% CI)"))
### add text with Q-value, dfs, p-value, and I^2 statistic
text(-5.7, -1.8, pos = 4, "Random-effect model")
text(-5.7, -2.8, pos = 4, bquote(paste("Heterogeneity: ", I^2, "=", .(formatC(res$I2, digits = 0, format = "f")),
"%; p=", .(formatC(res$QEp, digits = 4, format = "f")))))
## read in data
#install.packages("openxlsx")
library(openxlsx)
pacman::p_load(ggplot2, openxlsx, shape)
## 1. main model
library(metafor)
dat.ref <- read.xlsx(xlsxFile = 'C:/Users/wclzsdkjdx/Desktop/UOTP1 Greenness and rhinitis/data/Studies included in meta-analysis.xlsx', sheet = 3)
## claculate log(OR)
yi<-log(dat.ref$adj_r)
## calculate standardized deviation
er<-(log(dat.ref$adj_r)-log(dat.ref$adj_low))/1.96
vi<-er*er
### create study labels
dat.ref$slab <- with(dat.ref, paste(dat.ref$author, dat.ref$year, sep=", "))
### combine study labels with trial numbers in superscripts
dat.ref$slab.ref <- mapply(function(x,y) as.expression(bquote(.(x)^.(y))), dat.ref$slab, dat.ref$trial)
# meta-analysis, random-effects model
res<-rma(yi,vi, data = dat.ref, method="REML")
res
predict(res,transf = exp, digits = 3)
regtest(res, model = "lm")
### colors to be used in the plot
colp <- "#6b58a6"
coll <- "#a7a9ac"
### total number of studies
k <- nrow(dat.ref)
### generate point sizes
psize <- weights(res)
psize <- 1 + (psize - min(psize)) / (max(psize) - min(psize))
### get the weights and format them as will be used in the forest plot
weights <- formatC(weights(res), format="f", digits=1)
### forest plot with extra annotations
sav <- forest(res,  atransf=exp, at=log(c(0.4,1,1.6)), xlim = c(-5.8, 3.6), ylim = c(-0.95, k+3),
pch=18, psize=psize, xlab= "", cex=1.05, digits=2, refline = NA, efac = 2, col=colp, border=colp,
#slab = paste(dat.ref$author, dat.ref$year),
slab = slab.ref,
#ilab = cbind(dat.ref$age, paste(dat.ref$incidents, "/", dat.ref$population), weights),
ilab = cbind(paste(dat.ref$`incidence(n/N)`), weights),
#ilab.xpos = cbind(-3.7, -2.5, 1.4),
ilab.xpos = cbind(-2.5, 1.4),
mlab="", rowadj = -0.07)
### add vertical reference line at 1
segments(0, -2, 0, k+1, col=coll, lwd = 0.8)
### add vertical reference line at the pooled estimate
segments(coef(res), -1, coef(res), k, col=colp, lty="33", lwd=1.5)
### redraw the CI lines and points in the chosen color
#points(res$yi, k:1, pch=16, cex=psize*1.15, col="white")
points(res$yi, k:1, pch=18, cex=psize, col="black")
### now we add a bunch of text; since some of the text falls outside of the
### plot region, we set xpd=NA so nothing gets clipped
par(xpd=NA)
### use a non-bold font for the rest of the text
par(cex=sav$cex, font=1)
text(c(-5.4, 1.4), -0.95, c("Total", "100.0"))
### add 'Favours caffeine'/'Favours decaf' text below the x-axis
#install.packages('shape')
#library(shape)
#Arrows(0.2,-3.4, 1.2,-3.4, arr.type="triangle", lwd = 1)
#Arrows(-0.1,-3.4, -1.1,-3.4, arr.type="triangle", lwd = 1)
Arrows(0.2,-3.4, 1.2,-3.4, arr.adj = 0.5, arr.type="triangle", lwd = 1)
Arrows(-0.1,-3.4, -1.1,-3.4, arr.adj = 0.5, arr.type="triangle", lwd = 1)
text(c(-1.5, 1.4), -4, c("Favours rhinitis prevention","Favours rhinitis risk" ), pos=c(3,3), offset=-0.3)
### adjust cex as used in the forest plot and use a bold font
par(cex=sav$cex, font=2)
### add headings
#text(c(-3.7, -2.5, 1.4, 3), k+2.5, c("Age", paste("Incidents(n/N)"), "Weight", "Odds ratio"))
#text(c(-3.7, -2.5, 1.4, 3), k+1.5, c("(years)", "population",  "(%)", "(95% CI)"))
text(c(-2.5, 1.4, 3), k+2.5, c(paste("Incidence"), "Weight", "Odds ratio"))
text(c(-2.5, 1.4, 3), k+1.5, c("%(n/N)",  "(%)", "(95% CI)"))
### add text with Q-value, dfs, p-value, and I^2 statistic
text(-5.7, -1.8, pos = 4, "Random-effect model")
text(-5.7, -2.8, pos = 4, bquote(paste("Heterogeneity: ", I^2, "=", .(formatC(res$I2, digits = 0, format = "f")),
"%; p=", .(formatC(res$QEp, digits = 4, format = "f"))))) res$
funnel(taf, back = "white", atransf = exp, xlab = "Odds Ratio")
## read in data
#install.packages("openxlsx")
library(openxlsx)
pacman::p_load(ggplot2, openxlsx, shape)
## 1. main model
library(metafor)
dat.ref <- read.xlsx(xlsxFile = 'C:/Users/wclzsdkjdx/Desktop/UOTP1 Greenness and rhinitis/data/Studies included in meta-analysis.xlsx', sheet = 3)
## claculate log(OR)
yi<-log(dat.ref$adj_r)
## calculate standardized deviation
er<-(log(dat.ref$adj_r)-log(dat.ref$adj_low))/1.96
vi<-er*er
### create study labels
dat.ref$slab <- with(dat.ref, paste(dat.ref$author, dat.ref$year, sep=", "))
### combine study labels with trial numbers in superscripts
dat.ref$slab.ref <- mapply(function(x,y) as.expression(bquote(.(x)^.(y))), dat.ref$slab, dat.ref$trial)
# meta-analysis, random-effects model
res<-rma(yi,vi, data = dat.ref, method="REML")
res
predict(res,transf = exp, digits = 3)
regtest(res, model = "lm")
### colors to be used in the plot
colp <- "#6b58a6"
coll <- "#a7a9ac"
### total number of studies
k <- nrow(dat.ref)
### generate point sizes
psize <- weights(res)
psize <- 1 + (psize - min(psize)) / (max(psize) - min(psize))
### get the weights and format them as will be used in the forest plot
weights <- formatC(weights(res), format="f", digits=1)
### forest plot with extra annotations
sav <- forest(res,  atransf=exp, at=log(c(0.4,1,1.6)), xlim = c(-5.8, 3.6), ylim = c(-0.95, k+3),
pch=18, psize=psize, xlab= "", cex=1.05, digits=2, refline = NA, efac = 2, col=colp, border=colp,
#slab = paste(dat.ref$author, dat.ref$year),
slab = slab.ref,
#ilab = cbind(dat.ref$age, paste(dat.ref$incidents, "/", dat.ref$population), weights),
ilab = cbind(paste(dat.ref$`incidence(n/N)`), weights),
#ilab.xpos = cbind(-3.7, -2.5, 1.4),
ilab.xpos = cbind(-2.5, 1.4),
mlab="", rowadj = -0.07)
### add vertical reference line at 1
segments(0, -2, 0, k+1, col=coll, lwd = 0.8)
### add vertical reference line at the pooled estimate
segments(coef(res), -1, coef(res), k, col=colp, lty="33", lwd=1.5)
### redraw the CI lines and points in the chosen color
#points(res$yi, k:1, pch=16, cex=psize*1.15, col="white")
points(res$yi, k:1, pch=18, cex=psize, col="black")
### now we add a bunch of text; since some of the text falls outside of the
### plot region, we set xpd=NA so nothing gets clipped
par(xpd=NA)
### use a non-bold font for the rest of the text
par(cex=sav$cex, font=1)
text(c(-5.4, 1.4), -0.95, c("Total", "100.0"))
### add 'Favours caffeine'/'Favours decaf' text below the x-axis
#install.packages('shape')
#library(shape)
#Arrows(0.2,-3.4, 1.2,-3.4, arr.type="triangle", lwd = 1)
#Arrows(-0.1,-3.4, -1.1,-3.4, arr.type="triangle", lwd = 1)
Arrows(0.2,-3.4, 1.2,-3.4, arr.adj = 0.5, arr.type="triangle", lwd = 1)
Arrows(-0.1,-3.4, -1.1,-3.4, arr.adj = 0.5, arr.type="triangle", lwd = 1)
text(c(-1.5, 1.4), -4, c("Favours rhinitis prevention","Favours rhinitis risk" ), pos=c(3,3), offset=-0.3)
### adjust cex as used in the forest plot and use a bold font
par(cex=sav$cex, font=2)
### add headings
#text(c(-3.7, -2.5, 1.4, 3), k+2.5, c("Age", paste("Incidents(n/N)"), "Weight", "Odds ratio"))
#text(c(-3.7, -2.5, 1.4, 3), k+1.5, c("(years)", "population",  "(%)", "(95% CI)"))
text(c(-2.5, 1.4, 3), k+2.5, c(paste("Incidence"), "Weight", "Odds ratio"))
text(c(-2.5, 1.4, 3), k+1.5, c("%(n/N)",  "(%)", "(95% CI)"))
### add text with Q-value, dfs, p-value, and I^2 statistic
text(-5.7, -1.8, pos = 4, "Random-effect model")
text(-5.7, -2.8, pos = 4, bquote(paste("Heterogeneity: ", I^2, "=", .(formatC(res$I2, digits = 0, format = "f")),
"%; p=", .(formatC(res$QEp, digits = 4, format = "f")))))
####3. funnel plot####
### carry out trim-and-fill analysis
taf <- trimfill(res)
funnel(taf, back = "white", atransf = exp, xlab = "Odds Ratio")
## read in data
#install.packages("openxlsx")
library(openxlsx)
pacman::p_load(ggplot2, openxlsx, shape)
## 1. main model
library(metafor)
dat.ref <- read.xlsx(xlsxFile = 'C:/Users/wclzsdkjdx/Desktop/UOTP1 Greenness and rhinitis/data/Studies included in meta-analysis.xlsx', sheet = 3)
## claculate log(OR)
yi<-log(dat.ref$adj_r)
## calculate standardized deviation
er<-(log(dat.ref$adj_r)-log(dat.ref$adj_low))/1.96
vi<-er*er
### create study labels
dat.ref$slab <- with(dat.ref, paste(dat.ref$author, dat.ref$year, sep=", "))
### combine study labels with trial numbers in superscripts
dat.ref$slab.ref <- mapply(function(x,y) as.expression(bquote(.(x)^.(y))), dat.ref$slab, dat.ref$trial)
# meta-analysis, random-effects model
res<-rma(yi,vi, data = dat.ref, method="REML")
res
predict(res,transf = exp, digits = 3)
regtest(res, model = "lm")
### colors to be used in the plot
colp <- "#6b58a6"
coll <- "#a7a9ac"
### total number of studies
k <- nrow(dat.ref)
### generate point sizes
psize <- weights(res)
psize <- 1 + (psize - min(psize)) / (max(psize) - min(psize))
### get the weights and format them as will be used in the forest plot
weights <- formatC(weights(res), format="f", digits=1)
### forest plot with extra annotations
sav <- forest(res,  atransf=exp, at=log(c(0.4,1,1.6)), xlim = c(-5.8, 3.6), ylim = c(-0.95, k+3),
pch=18, psize=psize, xlab= "", cex=1.05, digits=2, refline = NA, efac = 2, col=colp, border=colp,
#slab = paste(dat.ref$author, dat.ref$year),
slab = slab.ref,
#ilab = cbind(dat.ref$age, paste(dat.ref$incidents, "/", dat.ref$population), weights),
ilab = cbind(paste(dat.ref$`incidence(n/N)`), weights),
#ilab.xpos = cbind(-3.7, -2.5, 1.4),
ilab.xpos = cbind(-2.5, 1.4),
mlab="", rowadj = -0.07)
### add vertical reference line at 1
segments(0, -2, 0, k+1, col=coll, lwd = 0.8)
### add vertical reference line at the pooled estimate
segments(coef(res), -1, coef(res), k, col=colp, lty="33", lwd=1.5)
### redraw the CI lines and points in the chosen color
#points(res$yi, k:1, pch=16, cex=psize*1.15, col="white")
points(res$yi, k:1, pch=18, cex=psize, col="black")
### now we add a bunch of text; since some of the text falls outside of the
### plot region, we set xpd=NA so nothing gets clipped
par(xpd=NA)
### use a non-bold font for the rest of the text
par(cex=sav$cex, font=1)
text(c(-5.4, 1.4), -0.95, c("Total", "100.0"))
### add 'Favours caffeine'/'Favours decaf' text below the x-axis
#install.packages('shape')
#library(shape)
#Arrows(0.2,-3.4, 1.2,-3.4, arr.type="triangle", lwd = 1)
#Arrows(-0.1,-3.4, -1.1,-3.4, arr.type="triangle", lwd = 1)
Arrows(0.2,-3.4, 1.2,-3.4, arr.adj = 0.5, arr.type="triangle", lwd = 1)
Arrows(-0.1,-3.4, -1.1,-3.4, arr.adj = 0.5, arr.type="triangle", lwd = 1)
text(c(-1.5, 1.4), -4, c("Favours rhinitis prevention","Favours rhinitis risk" ), pos=c(3,3), offset=-0.3)
### adjust cex as used in the forest plot and use a bold font
par(cex=sav$cex, font=2)
### add headings
#text(c(-3.7, -2.5, 1.4, 3), k+2.5, c("Age", paste("Incidents(n/N)"), "Weight", "Odds ratio"))
#text(c(-3.7, -2.5, 1.4, 3), k+1.5, c("(years)", "population",  "(%)", "(95% CI)"))
text(c(-2.5, 1.4, 3), k+2.5, c(paste("Incidence"), "Weight", "Odds ratio"))
text(c(-2.5, 1.4, 3), k+1.5, c("%(n/N)",  "(%)", "(95% CI)"))
### add text with Q-value, dfs, p-value, and I^2 statistic
text(-5.7, -1.8, pos = 4, "Random-effect model")
text(-5.7, -2.8, pos = 4, bquote(paste("Heterogeneity: ", I^2, "=", .(formatC(res$I2, digits = 0, format = "f")),
"%; p=", .(formatC(res$QEp, digits = 4, format = "f")))))
####3. funnel plot####
### carry out trim-and-fill analysis
taf <- trimfill(res)
funnel(taf, back = "white", atransf = exp, xlab = "Odds Ratio")
regtest(res, model = "lm")
## read in data
#install.packages("openxlsx")
library(openxlsx)
pacman::p_load(ggplot2, openxlsx, shape)
## 1. main model
library(metafor)
dat.ref <- read.xlsx(xlsxFile = 'C:/Users/wclzsdkjdx/Desktop/UOTP1 Greenness and rhinitis/data/Studies included in meta-analysis.xlsx', sheet = 3)
## claculate log(OR)
yi<-log(dat.ref$adj_r)
## calculate standardized deviation
er<-(log(dat.ref$adj_r)-log(dat.ref$adj_low))/1.96
vi<-er*er
### create study labels
dat.ref$slab <- with(dat.ref, paste(dat.ref$author, dat.ref$year, sep=", "))
### combine study labels with trial numbers in superscripts
dat.ref$slab.ref <- mapply(function(x,y) as.expression(bquote(.(x)^.(y))), dat.ref$slab, dat.ref$trial)
# meta-analysis, random-effects model
res<-rma(yi,vi, data = dat.ref, method="REML")
res
predict(res,transf = exp, digits = 3)
regtest(res, model = "lm")
### colors to be used in the plot
colp <- "#6b58a6"
coll <- "#a7a9ac"
### total number of studies
k <- nrow(dat.ref)
### generate point sizes
psize <- weights(res)
psize <- 1 + (psize - min(psize)) / (max(psize) - min(psize))
### get the weights and format them as will be used in the forest plot
weights <- formatC(weights(res), format="f", digits=1)
### forest plot with extra annotations
sav <- forest(res,  atransf=exp, at=log(c(0.4,1,1.6)), xlim = c(-5.8, 3.6), ylim = c(-0.95, k+3),
pch=18, psize=psize, xlab= "", cex=1.05, digits=2, refline = NA, efac = 2, col="tomato", border=colp,
#slab = paste(dat.ref$author, dat.ref$year),
slab = slab.ref,
#ilab = cbind(dat.ref$age, paste(dat.ref$incidents, "/", dat.ref$population), weights),
ilab = cbind(paste(dat.ref$`incidence(n/N)`), weights),
#ilab.xpos = cbind(-3.7, -2.5, 1.4),
ilab.xpos = cbind(-2.5, 1.4),
mlab="", rowadj = -0.07)
### add vertical reference line at 1
segments(0, -2, 0, k+1, col=coll, lwd = 0.8)
### add vertical reference line at the pooled estimate
segments(coef(res), -1, coef(res), k, col=colp, lty="33", lwd=1.5)
### redraw the CI lines and points in the chosen color
#points(res$yi, k:1, pch=16, cex=psize*1.15, col="white")
points(res$yi, k:1, pch=18, cex=psize, col="black")
### now we add a bunch of text; since some of the text falls outside of the
### plot region, we set xpd=NA so nothing gets clipped
par(xpd=NA)
### use a non-bold font for the rest of the text
par(cex=sav$cex, font=1)
text(c(-5.4, 1.4), -0.95, c("Total", "100.0"))
### add 'Favours caffeine'/'Favours decaf' text below the x-axis
#install.packages('shape')
#library(shape)
#Arrows(0.2,-3.4, 1.2,-3.4, arr.type="triangle", lwd = 1)
#Arrows(-0.1,-3.4, -1.1,-3.4, arr.type="triangle", lwd = 1)
Arrows(0.2,-3.4, 1.2,-3.4, arr.adj = 0.5, arr.type="triangle", lwd = 1)
Arrows(-0.1,-3.4, -1.1,-3.4, arr.adj = 0.5, arr.type="triangle", lwd = 1)
text(c(-1.5, 1.4), -4, c("Favours rhinitis prevention","Favours rhinitis risk" ), pos=c(3,3), offset=-0.3)
### adjust cex as used in the forest plot and use a bold font
par(cex=sav$cex, font=2)
### add headings
#text(c(-3.7, -2.5, 1.4, 3), k+2.5, c("Age", paste("Incidents(n/N)"), "Weight", "Odds ratio"))
#text(c(-3.7, -2.5, 1.4, 3), k+1.5, c("(years)", "population",  "(%)", "(95% CI)"))
text(c(-2.5, 1.4, 3), k+2.5, c(paste("Incidence"), "Weight", "Odds ratio"))
text(c(-2.5, 1.4, 3), k+1.5, c("%(n/N)",  "(%)", "(95% CI)"))
### add text with Q-value, dfs, p-value, and I^2 statistic
text(-5.7, -1.8, pos = 4, "Random-effect model")
text(-5.7, -2.8, pos = 4, bquote(paste("Heterogeneity: ", I^2, "=", .(formatC(res$I2, digits = 0, format = "f")),
"%; p=", .(formatC(res$QEp, digits = 4, format = "f")))))
load("D:/R/Rwork/website/.RData")
